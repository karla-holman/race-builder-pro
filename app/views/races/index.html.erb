<div class="row">
  <div class="col-xs-12">
    <h2><%= current_user.name %>'s Races</h2>
    <% if current_user.admin? %>
      <%= link_to 'New Race', new_race_path, :class => 'btn btn-primary btn-small' %>
    <% end %>
  </div>
  <div class="col-xs-12">
    <div class="grid simple">
      <div class="grid-body no-border">
        <div class="row">
          <div class="col-xs-12">
            <table class="detailTable table table-condensed table-hover">
              <thead>
                <tr>
                  <th>Name</th> 
                  <th>Status</th>
                  <th>Priority</th>
                  <th style="display: none;">Conditions</th>
                  <th style="display: none;">Description</th>
                  <th style="display: none;">Category</th>
                  <th style="display: none;">Stakes</th>
                  <th style="display: none;">Date</th>
                  <th colspan="1"></th>
                </tr>
              </thead>
              <tbody>
                <% @races.each do |race| %>
                  <tr>
                    <td><%= race.name %></td>
                    <td>
                      <% if race.status == "Draft"%>
                        <%= link_to 'Draft', {:controller => "races", :action => "update_status", :status => "Published", :id => race.id }, :class => 'btn btn-warning btn-mini' %>
                      <% else %>
                        <%= link_to 'Published', {:controller => "races", :action => "update_status", :status => "Draft", :id => race.id }, :class => 'btn btn-success btn-mini' %>
                      <% end %>
                    </td>
                    <td>
                      <% if race.category == 'Priority' %>
                        <span class="label label-inverse">Yes</span>
                      <% else %>
                        <span class="label badge-danger">No</span>
                      <% end %>
                    </td>
                    <td style="display: none;">
                    <% conditions = race.conditions %>
                    <% if conditions.any? %>
                        <% conditions.each do |condition| %>
                            <%= condition.name %>&nbsp;
                        <% end %>
                    <% else %>
                      None
                    <% end %>
                    </td>
                    <td style="display: none;"><%= race.category %></td>
                    <td style="display: none;"><%if race.stakes %>Yes<%else%>No<%end%></td>
                    <td style="display: none;">
                      <% if race.category == 'Priority' && race.race_date && race.race_date.date %>
                        <%= race.race_date.date.strftime('%b %d, %Y') %>
                      <% else %>
                        N/A
                      <% end %>
                    </td>
                    <td style="display: none;"><%= race.description %></td>
                    <td>
                      <%= link_to 'Show', race, :class => 'btn btn-success btn-mini' %>
                      <%= link_to 'Edit', edit_race_path(race), :class => 'btn btn-warning btn-mini', 'data-no-turbolink' => true %>
                      <%= link_to 'Delete', race, method: :delete, data: { confirm: 'Are you sure?' }, :class => 'btn btn-danger   btn-mini' %>
                      <%= link_to 'Duplicate', '/races/'+race.id.to_s+'/duplicate', :method=> :post, :class => 'btn btn-primary btn-mini' %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  /* Formating function for row details */
  function fnFormatDetails ( oTable, nTr )
  {
    var aData = oTable.fnGetData( nTr );
    var sOut = '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;" class="inner-table">';
    sOut += '<tr><td>Conditions: </td><td>'+aData[4]+'</td></tr>';
    sOut += '<tr><td>Description:</td><td>'+aData[5]+'</td></tr>';
    sOut += '<tr><td>Category:</td><td>'+aData[6]+'</td></tr>';
    sOut += '<tr><td>Stakes: </td><td>'+aData[7]+'</td></tr>';
    sOut += '<tr><td>Date:</td><td>'+aData[8]+'</td></tr>';
    sOut += '</table>';
     
    return sOut;
  }
</script>
