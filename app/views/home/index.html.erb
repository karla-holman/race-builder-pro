<div class="row">
	<h1>
		<% if !current_user.nil? %>
			<%= current_user.name %>, 
		<% end %> 
			Welcome to Race Builder Pro
	</h1>
	<h5>Version: 2.0</h5>
	<% @tels.each do |tel| %>
	  <div class="col-xs-12">
	  	<h4>TEL <%= tel.date.strftime('%b %d, %Y') %></h4>
	  	<h4>Number of Races: <%= tel.num_races %></h4>
	    <div class="grid simple">
	      <div class="grid-body no-border">
	        <div class="row">
	          <div class="col-xs-12">
	            <table num-races="<%= tel.num_races %>" class="telTable targetTels table table-condensed table-hover">
	              <thead>
	                <tr>
	                  	<td>Race</td>
						<td>Interested</td>
						<td>Confirmed</td>
						<td>Priority</td>
						<th colspan="1"></th>
	                </tr>
	              </thead>
	              <tbody>
	                <% tel.races.each do |race| %>
	                  	<tr>
							<td class="condition-book">
								<div class="race-type">
									<span><%= race.race_type %></span>
								</div>
								<div class="race-description">
									<span>Purse: <%= number_to_currency(race.purse, precision: 0) %>. <%= race.description %></span>
								</div>
								<div class="race-weight">
									<span><%= race.weights %></span>
								</div>
								<div class="race-claiming">
									<span>
										<% if race.claiming_prices[0] &&  race.claiming_prices[0].price%>
                                        	<% if race.claiming_prices[1] && race.claiming_prices[1].price %>
                                            	<% if race.claiming_prices[0].price >= race.claiming_prices[1].price %>
                                                	Claiming Price: <%= number_to_currency(race.claiming_prices[0].price, precision: 0) %> - <%= number_to_currency(race.claiming_prices[1].price, precision: 0) %>
                                            	<% else %>
                                                	Claiming Price: <%= number_to_currency(race.claiming_prices[1].price, precision: 0) %> - <%= number_to_currency(race.claiming_prices[0].price, precision: 0) %>
                                            	<% end %>
                                        	<% else %>
                                            	Claiming Price: <%= number_to_currency(race.claiming_prices[0].price, precision: 0) %>
                                        	<% end %>
                                    	<% elsif race.claiming_prices[1] && race.claiming_prices[1].price %>
                                        	Claiming Price: <%= number_to_currency(race.claiming_prices[1].price, precision: 0) %>
                                    	<% end %>
									</span>
								</div>
								<div class="race-distance pull-right">
									<span><%= race.distance %> <%= race.distance_type %></span>
								</div>
							</td>
							<td>
								<span class="badge badge-danger">
									<%= race.horseraces.where(:status => "Interested").count %>
								</span>
							</td>
							<td>
								<span class="badge badge-success">
									<%= race.horseraces.where(:status => "Confirmed").count %>
								</span>
							</td>
							<td>
								<% if race.category == 'Priority' %>
									<span class="label label-inverse">Yes</span>
								<% else %>
									<span class="label badge-danger">No</span>
								<% end %>
							</td>
							<td>
							<% if current_user.admin? %>
								<%= link_to 'View', race, :class => 'btn btn-success btn-mini' %>
							<% end %>
						</tr>
	                <% end %>
	              </tbody>
	            </table>
	          </div>
	        </div>
	      </div>
	    </div>
	  </div>
	<% end %>

	<% if !current_user.admin? %>
		<h3>Current Stable:</h3>
		<div class="grid simple">
			<div class="grid-body no-border">
				<div class="row">
					<div class="col-xs-12">
						<table class="table table-condensed">
							<thead>
								<tr>
									<th>Name</th>
									<% if current_user.admin? %>
								    	<th>Trainer</th>
								    <% else %>
								    	<th>Owner</th>
								    <% end %>
									<th colspan="1"></th>
									<th colspan="1"></th>
								</tr>
							</thead>
							<tbody>
								<% @horses.each do |horse| %>
								<tr>
									<td>
										<%= horse.name %>
									</td>
									<% if current_user.admin? %>
						                <td><%= horse.trainer.name %></td>
						            <% else %>
						                <td><%= horse.owner.name %></td>
						            <% end %>
									<td style="display:none;">
										<% if horse.equipment.any? %>
							                <% horse.equipment.each do |equipment| %>
							                  <%= equipment.name %>&nbsp;
							                <% end %>
							              <% else %>
							                None
							              <% end %>
									</td>
									<td style="display:none;">
										<% racestatuses = horse.horseraces.where("status = ? OR status = ? AND horse_id = ?", "Interested", "Confirmed", horse.id) %>
										<% if racestatuses.any? %>
											<ul class="condition-list no-indent">
												<% racestatuses.each do |racestatus| %>
													<li><%= Race.find(racestatus.race_id).name %> - <%= racestatus.status %></li>
												<% end %>
											</ul>
										<% else %>
											None
										<% end %> 
									</td>
									<td><%= link_to 'Race Menu', races_menu_path(:horse_id => horse.id), :class => 'btn btn-success btn-mini' %></td>
									<td><%= link_to 'View Horse', horse, :class => 'btn btn-primary btn-mini'%></td>
								</tr>
								<% end %>  
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	<% end %>
	
	<div class="col-xs-12">
		<h3>Races</h3>
		<div class="grid simple">
			<div class="grid-body no-border">
				<div class="row">
					<div class="col-xs-12">
						<table id="dashboard-admin-table" class="committed-sort table table-condensed table-hover">
							<thead>
								<tr>
									<th>Name</th>
									<th>Claiming</th>
									<th>Distance</th>
									<th>Interested</th>
									<th>Confirmed</th>
									<th style="display:none;">Race</th>
									<th style="display:none;">Interested</th>
									<th style="display:none;">Cofirmed</th>
									<th>Priority</th>
								</tr>
							</thead>
							<tbody>
								<% @races.each do |race| %>
								<tr>
									<td>
										<%= race.name %>
									</td>
									<td>
                                    <% if race.claiming_prices[0] &&  race.claiming_prices[0].price%>
                                        <% if race.claiming_prices[1] && race.claiming_prices[1].price %>
                                            <% if race.claiming_prices[0].price >= race.claiming_prices[1].price %>
                                                <%= number_to_currency(race.claiming_prices[0].price, precision: 0) %> - <%= number_to_currency(race.claiming_prices[1].price, precision: 0) %>
                                            <% else %>
                                                <%= number_to_currency(race.claiming_prices[1].price, precision: 0) %> - <%= number_to_currency(race.claiming_prices[0].price, precision: 0) %>
                                            <% end %>
                                        <% else %>
                                            <%= number_to_currency(race.claiming_prices[0].price, precision: 0) %>
                                        <% end %>
                                    <% elsif race.claiming_prices[1] && race.claiming_prices[1].price %>
                                        <%= number_to_currency(race.claiming_prices[1].price, precision: 0) %>
                                    <% end %>
                                    </td>
                                    <% if race.distance %>
                                        <% if race.distance <= 1 %>
                                            <% if race.distance_type == 'Furlongs' %>
                                                <td><%= race.distance %> Furlong</td>
                                            <% elsif race.distance_type == 'Yards'%>
                                                <td><%= race.distance %> Yard</td>
                                            <% else %>
                                                <td><%= race.distance %> Mile</td>
                                            <% end %>
                                        <% else %>
                                            <td><%= race.distance %> <%= race.distance_type %></td>
                                        <% end %>
                                    <% else %>
                                        <td>N/A</td>
                                    <% end %>
									<td>
										<span class="badge badge-danger">
											<%= race.horseraces.where(:status => "Interested").count %>
										</span>
									</td>
									<td>
										<span class="badge badge-success">
											<%= race.horseraces.where(:status => "Confirmed").count %>
										</span>
									</td>
									<td class="condition-book" style="display:none;">
										<div class="race-type">
											<span><%= race.race_type %></span>
										</div>
										<div class="race-description">
											<span>Purse:<%= number_to_currency(race.purse, precision: 0) %>. <%= race.description %></span>
										</div>
										<div class="race-weight">
											<span><%= race.weights %></span>
										</div>
										<div class="race-claiming">
											<span>
												<% if race.claiming_prices[0] &&  race.claiming_prices[0].price%>
		                                        	<% if race.claiming_prices[1] && race.claiming_prices[1].price %>
		                                            	<% if race.claiming_prices[0].price >= race.claiming_prices[1].price %>
		                                                	Claiming Price: <%= number_to_currency(race.claiming_prices[0].price, precision: 0) %> - <%= number_to_currency(race.claiming_prices[1].price, precision: 0) %>
		                                            	<% else %>
		                                                	Claiming Price: <%= number_to_currency(race.claiming_prices[1].price, precision: 0) %> - <%= number_to_currency(race.claiming_prices[0].price, precision: 0) %>
		                                            	<% end %>
		                                        	<% else %>
		                                            	Claiming Price: <%= number_to_currency(race.claiming_prices[0].price, precision: 0) %>
		                                        	<% end %>
		                                    	<% elsif race.claiming_prices[1] && race.claiming_prices[1].price %>
		                                        	Claiming Price: <%= number_to_currency(race.claiming_prices[1].price, precision: 0) %>
		                                    	<% end %>
											</span>
										</div>
										<div class="race-distance pull-right">
											<span><%= race.distance %> <%= race.distance_type %></span>
										</div>
									</td>
									<td style="display:none;">
										<% race.horseraces.where(:status => "Interested").each do |interested| %> 
											<% horse = Horse.find(interested.horse_id) %>
											<% if current_user.trainer? %>
												<% if horse.trainer_id == current_user.id %>
													<%= horse.name %>
												<% end %>
											<% elsif current_user.user?%>
												<% if horse.owner_id == current_user.id %>
													<%= horse.name %>
												<% end %>
											<% else %>
												<%= horse.name %>&nbsp;
											<% end %>	
										<% end %>
									</td>
									<td style="display:none;">
										<% race.horseraces.where(:status => "Confirmed").each do |confirmed| %>
											<% horse = Horse.find(confirmed.horse_id) %>
											<% if current_user.trainer? %>
												<% if horse.trainer_id == current_user.id %>
													<%= horse.name %>
												<% end %>
											<% elsif current_user.user?%>
												<% if horse.owner_id == current_user.id %>
													<%= horse.name %>
												<% end %>
											<% else %>
												<%= horse.name %>&nbsp;
											<% end %>
										<% end %>
									</td>
									<td>
										<% if race.category == 'Priority' %>
											<span class="label label-inverse">Yes</span>
										<% else %>
											<span class="label badge-danger">No</span>
										<% end %>
									</td>
								</tr>
								<% end %>  
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script>
/* Formating function for row details */
function fnFormatDetails ( oTable, nTr )
{
	var aData = oTable.fnGetData( nTr );
	var sOut = '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px; width: 100%;" class="inner-table">';
	sOut += '<tr><td class="condition-book">'+aData[6]+'</td></tr>';
	sOut += '<tr><td>Interested: '+aData[7]+'</td></tr>';
	sOut += '<tr><td>Confirmed: '+aData[8]+'</td></tr>';
	sOut += '</table>';

	return sOut;
}

</script>

